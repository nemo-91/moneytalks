


# Exercise 1
Merge all the datasets in one dataset only, this should be written in R too, it will take a bit of time to read all the dataset, and then concatenate them. However, it should be straightforward. Please, save the final dataset, there should be an export function in R. Now on, all the next steps have to be done on the huge dataset.

```{r}
library(data.table)
files = list.files(pattern="*.csv")
data = rbindlist(lapply(files, fread))

```

Rename to underscore naming convension and renamed "d_change" => "Change %"
```{r}
#install.packages("dplyr")
library("dplyr")

data <- rename(data, date = "Date", price = "Price", open = "Open", high = "High", low = "Low", volume =  "Vol.", d_change = "Change %", stock = "Stock", o_change = "O-Change", w_change = "W-Change", m_change = "M-Change", day = "Day", month = "Month", year = "Year")

```

Delete row that contain missing values (#DIV/0!)

```{r}
data <- data[!grepl("#DIV/0!", data$m_change),]
data <- data[,-1]  
```

Export Data into a file
```{r}
#Create CSV file**
# data <-data %>% drop_na()
# ac <- write.csv(data, file = "complete_data.csv")
# ac
```


```{r}
#str(data)
data <- transform(data, o_change = as.numeric(o_change),
               w_change = as.numeric(w_change), m_change = as.numeric(m_change))

```

Remove NAs
```{r}
library(tidyr)
data <-data %>% drop_na()

```


# Exercise 2
Density plot (or box plot) of the following values (this is for the data exploration): Change %, o-change, w-change and m-change, (you can refer to homework 2 to solve this task).
```{r}
colnames(data)
plot_data <- data[,8:10]
```
```{r}
# myData <- data.frame(std.nromal=rnorm(1000, m=0, sd=1),
#                      wide.normal=rnorm(1000, m=0, sd=2),
#                      exponent=rexp(1000, rate=1),
#                      uniform=runif(1000, min=-3, max=3)
#                      )

dens <- apply(plot_data, 2, density)

plot("Density", xlim=range(sapply(dens, "[", "x")), ylim=range(sapply(dens, "[", "y")))
mapply(lines, dens, col=1:length(dens))

legend("topright", legend=names(dens), fill=1:length(dens))
```



```{r}

library(ggplot2) 
ggplot(data, aes(x = d_change)) + 
  geom_density() +
  xlim(-15,15)
```


```{r}

library(ggplot2)
ggplot(data, aes(x = o_change)) +
  geom_density()+
  xlim(-10,10)
```


```{r}

library(ggplot2) 
ggplot(data, aes(x = w_change)) + 
  geom_density() +
  xlim(-25,25)
```


```{r}

library(ggplot2) 
ggplot(data, aes(x = m_change)) + 
  geom_density() +
  xlim(-50,60)
```



# Exercise 3
In each month (for the five different years), count the total positive and the negative days (i.e. use 'Change %' > and < abs(value)), the value can be set to 0 at the beginning, but it would be better if it is parameter. So we can alter it later.
```{r}
#install.packages("dplyr")
library(dplyr)
total_positive <- function(df, value) {
  summarise(filter(df, d_change>abs(value)), n())
}

total_negative <- function(df, value) {
  summarise(filter(df, d_change<abs(value)), n())
}

```


```{r}
distinct_years <- unique(data$year)
distinct_years
distinct_months <- unique(data$month)
distinct_months
```

```{r}

iterations = 72
variables = 4

d_change_output <- matrix(ncol=variables, nrow=iterations)

y <- 0
 for(yr in distinct_years) {
  this_year_data <- filter(data, year == yr)
  for(mth in distinct_months) {
    
   this_month_data  <- filter(this_year_data , month == mth)
   this_month_total_positive <- total_positive(this_month_data, 0)[1,]
   this_month_total_negative <- total_negative(this_month_data, 0)[1,]
   
   d_change_output[y,1] <- yr
   d_change_output[y,2] <- mth
   d_change_output[y,3] <- this_month_total_positive
   d_change_output[y,4] <- this_month_total_negative
   y = y+1
  }
 }

```



```{r}

d_change_output <- data.frame(d_change_output)
d_change_output <- rename(d_change_output, year = X1, month = X2, total_positive = X3, total_negative = X4)
o_change_output <-o_change_output %>% drop_na()
d_change_original <- d_change_output
str(d_change_output)
```

# Exercise 4
Plot the result from point 3, in order to highlight if there are months, were most of the times the days are positives or negative, make 5 plots for different years (one per year, in each plot there should be 24 bars: the count of negative and positive days for each month).


```{r}
library(tidyr)
d_change_output <- gather(d_change_output, key=feature, value=value, total_positive, total_negative)

d_change_output <-d_change_output %>% drop_na()
```



```{r fig.width=15}
library(ggplot2) 
ggplot(d_change_output, aes(x=month, y=value, fill=feature)) + geom_bar(stat="identity") + facet_wrap(~ year, ncol = 2)
```


```{r}


```

# Exercise 5
Do the same of task 3 and 4, but this time fore the feature o-change.


```{r}

library(dplyr)
o_total_positive <- function(df, value) {
  summarise(filter(df, o_change>abs(value)), n())
}

o_total_negative <- function(df, value) {
  summarise(filter(df, o_change<abs(value)), n())
}


iterations = 72
variables = 4

o_change_output <- matrix(ncol=variables, nrow=iterations)

y <- 0
 for(yr in distinct_years) {
  this_year_data <- filter(data, year == yr)
  for(mth in distinct_months) {
    
   this_month_data  <- filter(this_year_data , month == mth)
   o_this_month_total_positive <- o_total_positive(this_month_data, 0)[1,]
   o_this_month_total_negative <- o_total_negative(this_month_data, 0)[1,]
   
   o_change_output[y,1] <- yr
   o_change_output[y,2] <- mth
   o_change_output[y,3] <- o_this_month_total_positive
   o_change_output[y,4] <- o_this_month_total_negative
   y = y+1
  }
 }

```



```{r}

o_change_output <- data.frame(o_change_output)
o_change_output <- rename(o_change_output, year = X1, month = X2, total_positive = X3, total_negative = X4)
o_change_output <-o_change_output %>% drop_na()
o_change_original <- o_change_output
str(o_change_output)
```

Plot the result, in order to highlight if there are months, were most of the times the days are positives or negative, make 5 plots for different years (one per year, in each plot there should be 24 bars: the count of negative and positive days for each month).


```{r}
library(tidyr)
o_change_output <- gather(o_change_output, key=feature, value=value, total_positive, total_negative)
o_change_output <-o_change_output %>% drop_na()
```



```{r fig.width=15}
library(ggplot2) 
ggplot(o_change_output, aes(x=month, y=value, fill=feature)) + geom_bar(stat="identity") + facet_wrap(~ year, ncol = 2)
```




# Exercise 6
Analyse the two values Change % and o-change. Compute the correlation between the two, and the average distance. Report the two final values.

```{r}
str(o_change_original)
str(d_change_original)
o <- as.matrix(o_change_original)
d <- as.matrix(d_change_original)

```


Correlation between the o_change and d_change positive and nagative counts 

```{r}
#make d and o matrices same dimension
d <- d[1:71,]

#compute the correlation matrix 
cor_matrix <- cor(o, d, use = "everything",method = c("pearson", "kendall", "spearman"))
cor_matrix

#correlation between o_change and d_change total positive
cor_matrix[3,3]

#correlation between o_change and d_change total negative
cor_matrix[4,4]
```


Average distance between the o_change and d_change positive and nagative counts 
[1] year, [2] month, [3] total_positive, [4] total_negative

```{r}
library(pdist)
#distance matrix
dists <- pdist(t(o), t(d))
dists <- as.matrix(dists)
dists

#distance between o_change and d_change total positive
dists[3,3]

#distance between o_change and d_change total negative
dists[4,4]
```



